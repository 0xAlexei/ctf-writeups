Open-gyckel-krypto
=================

**Category**: crypto

Points: 226

Solves: 56

**Problem description**:  Primes are fun, don't google translate me bro

---

The problem is a typical RSA problem with a twist on the way primes are generated.

```py2
while True:
    p = next_prime(random.randint(0, 10**500))
    if len(str(p)) != 500:
        continue
    q = Integer(int(str(p)[250:] + str(p)[:250]))
    if q.is_prime():
        break
```

First a random p value is generated, and then the q value is generated as some combination of the digits of p. The process is repeated
until both p and q are prime.

Let us consider the first 250 digits of p to be `a` and the last 250 digits to be `b`. Then the primes can be written down as:

```
p = a * 10^250 + b
q = b * 10^250 + a
```

Multiplying p and q, we get:

```
p * q = ab * 10^500 + a^2 * 10^250 + b^2 * 10^250 + ab
      = ab * 10^500 + (a^2 + b^2) * 10^250 + ab
```

As a and b are both 250 digits long, both `ab` and `a^2 + b^2` will be either 500 or 501 digits long.
Using this information, we can extract the first 250 digits of `ab` from the first 250 digits of `n` and the
last 250 digits of `ab` from the last 250 digits of `n`. The only thing to worry about is that if `a^2 + b^2` is 501 digits
long which might result in a carry. As it is only 1 digit, we can brute force all the values of the carry. After finding `ab`, it is
simple algebra to get back to `a` and `b` from which we can get the primes p and q.


Solution:

```py2
from gmpy import *
from Crypto.Util.number import *

n = 6146024643941503757217715363256725297474582575057128830681803952150464985329239705861504172069973746764596350359462277397739134788481500502387716062571912861345331755396960400668616401300689786263797654804338789112750913548642482662809784602704174564885963722422299918304645125966515910080631257020529794610856299507980828520629245187681653190311198219403188372517508164871722474627810848320169613689716990022730088459821267951447201867517626158744944551445617408339432658443496118067189012595726036261168251749186085493288311314941584653172141498507582033165337666796171940245572657593635107816849481870784366174740265906662098222589242955869775789843661127411493630943226776741646463845546396213149027737171200372484413863565567390083316799725434855960709541328144058411807356607316377373917707720258565704707770352508576366053160404360862976120784192082599228536166245480722359263166146184992593735550019325337524138545418186493193366973466749752806880403086988489013389009843734224502284325825989
C = 3572030904528013180691184031825875018560018830056027446538585108046374607199842488138228426133620939067295245642162497675548656988031367698701161407333098336631469820625758165691216722102954230039803062571915807926805842311530808555825502457067483266045370081698397234434007948071948000301674260889742505705689105049976374758307610890478956315615270346544731420764623411884522772647227485422185741972880247913540403503772495257290866993158120540920089734332219140638231258380844037266185237491107152677366121632644100162619601924591268704611229987050199163281293994502948372872259033482851597923104208041748275169138684724529347356731689014177146308752441720676090362823472528200449780703866597108548404590800249980122989260948630061847682889941399385098680402067366390334436739269305750501804725143228482932118740926602413362231953728010397307348540059759689560081517028515279382023371274623802620886821099991568528927696544505357451279263250695311793770159474896431625763008081110926072287874375257

ab_first = int(str(n).rstrip('L')[:250])
ab_last = int(str(n).rstrip('L')[-250:])

for add in range(3):
    ab = (ab_first - add) * 10**250 + ab_last
    a2_plus_b2 = n - 10**500 * ab - ab
    if a2_plus_b2 % 10**250 != 0:
        continue
    a2_plus_b2 /= 10**250
    a_plus_b_sq = a2_plus_b2 + 2 * ab
    a_plus_b = int(sqrt(a_plus_b_sq))
    if a_plus_b * a_plus_b != a_plus_b_sq:
        continue
    X = a_plus_b
    Y = ab
    a = (X + int(sqrt(X**2 - 4 * Y)))/2
    b = (X - int(sqrt(X**2 - 4 * Y)))/2
    p = 10**250 * a + b
    q = 10**250 * b + a
    print p
    print q
    assert p * q == n
    phi = (p - 1) * (q - 1)
    e = 65537
    d = invert(e, phi)
    M = pow(C, d, n)
    print repr(long_to_bytes(M))

# midnight{w3ll_wh47_d0_y0u_kn0w_7h15_15_4c7u4lly_7h3_w0rld5_l0n6357_fl46_4nd_y0u_f0und_17_50_y0u_5h0uld_b3_pr0ud_0f_y0ur53lf_50_uhmm_60_pr1n7_7h15_0n_4_75h1r7_0r_50m37h1n6_4nd_4m4z3_7h3_p30pl3_4r0und_y0u}
```
