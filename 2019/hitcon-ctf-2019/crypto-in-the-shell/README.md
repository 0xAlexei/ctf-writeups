# Crypto in the shell

We can AES encrypt relative to BSS and read the encrypted output. First we encrypt the unknown AES key itself so that we know the key. Then, we leak libc and pie by encrypting contents on bss, and decrypting the output since we know key and iv. Then, we can perform arbitrary writes by morphing iv by encrypting near the iv buffer. By morphing iv, we can get different LSBs or MSBs, and can do arbitrary write by writing these LSBs or MSBs byte by byte. However, since we are limited to 32 encrypt operations, we have to simulation locally how to morph IV to give us the byte we want. One issue is that the destination encrypt buffer is unknown, so we encrypt that to change it to something known, then perform the byte by byte write. One gadget did not work for any of the hooks, so I overwrite the hook called by _dl_fini in ld to system and rdi in the same region to sh.
