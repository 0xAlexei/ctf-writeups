WhiteHat 2020 Quals: Blockchain
===============================

We're given 2 private keys: `34a7370734caff5d129ad355f78f3ccf.pem`, `8a95963d7bedd2b81ad09cd1838c7a4d.pem`.

We can extract the modulus and private exponent using RsaCTFTool:

```sh
$ python ~/hack/RsaCtfTool/RsaCtfTool.py --dumpkey --key 34a7370734caff5d129ad355f78f3ccf.pem
[*] n: 3933301738623482824438423527443174024034903340575254516502107781450241559896803239143883018509648345485361873725629555553640770848086782431505505692289
[*] e: 65537
$ python ~/hack/RsaCtfTool/RsaCtfTool.py --dumpkey --key 8a95963d7bedd2b81ad09cd1838c7a4d.pem
[*] n: 1057400219548831590862498475261646567798980178278784386310020560367089188125453414566736447119699796555751827787628247382978018443997557989020536943983
[*] e: 65537
```

If we take the GCD of both the modulus, we see that they have a common factor, which means we can factor them and generate the private key.

```
>>> gcd(n1, n2)
1091951834898382993408357240646061116416467734213916798265279491274843400183L
>>> p = gcd(n1, n2)
>>> q1 = n1/p
>>> q2 = n2/p
>>> d1 = invert(65537, (p-1)*(q1-1))
>>> d2 = invert(65537, (p-1)*(q2-1))
```

Using, this we can decrypt the messages in the json blocks that we are given.

```py
>>> long_to_bytes(pow(864826346328927043007924641380681736981324987926997370887020532699182309378599192043216478265476219278213123962074508284028662403643532629433329761492, d1, n1))
'Do you understand the blockchain?'
>>> long_to_bytes(pow(259242051785557714557594066190019826465030870294179284671916925100489488841761299528416294893049464518482888070747927907550583942630013791833474340284, d2, n2))
'Password using open flag.zip'
>>> long_to_bytes(pow(3467074671076858427887425157777463145087476633275513864943463990703623032280801013924306443879332057123214793127862390154827554625137418534583896303616, d1, n1))
'flag in flag.txt'
>>> long_to_bytes(pow(260259490441096686614518844301454718739843509738983969165420676005404297357230613482141235832583253831691051931351295653801889428212969414301414329852, d2, n2))
'Password = Password1+Password2'
>>> long_to_bytes(pow(1535086324597057729311343510271769159442400498252787851926410538373297030193590329732950032623600137243772129943527400615893561445637150940979108765230, d1, n1))
"Password1:'irVOwoJR7d'"
>>> long_to_bytes(pow(182842058942028668693782090218012558408325328016978308589264490683273716484502724907545336344750909005728737352410277713521976130375761311818569486299, d2, n2))
"Password2:'D@V!4P##Ij'"
>>>
```

Using, the password, we can decrypt the flag.zip, which gives us a flag.txt which contains a base64 string. On decoding the base64 string,
we get a PNG file containing a QR code.

![Flag QR Code](flag.png)

On decoding the QR code, we get the flag

```
Whitehat{the_ flag_blockchain_ iot}
```
